<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>微信红包皮肤测试</title>

    <script src="js/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="js/jquery.tmpl.min.js" type="text/javascript"></script>

    <script type="text/javascript">

        $(function () {
            var iframe = document.createElement('iframe');
            iframe.setAttribute('id', 'toApp');
            iframe.setAttribute('style', 'display:none');
            document.body.appendChild(iframe);

        });



        function getuseragent() {
            console.log(navigator.userAgent);
            if(navigator.userAgent.indexOf("kmh_android")>0){
                document.title="在这android";
            }else if(navigator.userAgent.indexOf("KMHLite_iphone")>0){
                document.title="在这iphone";
            }
        }


        function webtoapp() {

            $("#toApp").attr("src", "tkanmanapp://goto?page=web&url="+encodeURIComponent(window.location.href));
        }

        function getuser() {

            $("#toApp").attr("src", "tkanmanapp://getuser?callback=showuser");
        }

        function recharge() {
            $("#toApp").attr("src", "tkanmanapp://goto?page=recharge");
        }

        getuseragent();


        function showuser(data) {
            //获取到app传过来的用户信息
            alert(JSON.stringify(data));
        }


        function handleVisibilityChange() {
            if (document.hidden) {
                document.title="离开了";
            } else  {
                document.title="在这";
                getuser();
            }
        }
        document.addEventListener("visibilitychange", handleVisibilityChange, false);


    </script>
</head>
<body>


<a class="btn" href="javascript:webtoapp()">看漫App内打开此页</a><br/><br/>


<a class="btn" href="javascript:getuser()"> 获取用户信息</a><br/>


<a class="btn" href="javascript:recharge()"> 跳转钻石充值页面</a><br/>


</body>


</html>